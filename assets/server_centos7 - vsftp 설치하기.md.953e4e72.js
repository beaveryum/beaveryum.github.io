import{_ as n,c as p,a as s,b as l,t as o,d as e,o as t}from"./app.86428379.js";const v=JSON.parse('{"title":"centos7 - vsftp 설치하기","description":"","frontmatter":{"title":"centos7 - vsftp 설치하기"},"headers":[],"relativePath":"server/centos7 - vsftp 설치하기.md","lastUpdated":1674745074000}'),c={name:"server/centos7 - vsftp 설치하기.md"},r={id:"frontmatter-title",tabindex:"-1"},C=s("a",{class:"header-anchor",href:"#frontmatter-title","aria-hidden":"true"},"#",-1),i=e(`<p>설치 됐는지 확인하기</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">list</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">installed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vsftpd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-qa</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vsftpd</span></span>
<span class="line"></span></code></pre></div><p>vsftpd를 설치하기</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vsftpd</span></span>
<span class="line"></span></code></pre></div><p>vsftpd를 업데이트</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">update</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vsftpd</span></span>
<span class="line"></span></code></pre></div><h4 id="설정-변경" tabindex="-1">설정 변경 <a class="header-anchor" href="#설정-변경" aria-hidden="true">#</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/vsftpd/vsftpd.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">anonymous_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">NO</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">local_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">write_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">local_umask</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">022</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">dirmessage_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">xferlog_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">connect_from_port_20</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">xferlog_file</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/var/log/xferlog</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">xferlog_std_format</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">chroot_local_user</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">listen</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pam_service_name</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">vsftpd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">userlist_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">tcp_wrappers</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"></span></code></pre></div><p>구동하기</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vsftpd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vsftpd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span></span>
<span class="line"></span></code></pre></div><p>동작 중인지 확인하기</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">netstat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-anp</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vsftpd</span></span>
<span class="line"></span></code></pre></div><p>방화벽 열기</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=21/tcp</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--zone=public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=20/tcp</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--reload</span></span>
<span class="line"></span></code></pre></div><p>에러 해결 하기</p><p>530 Permission denied 오류를 찾아보니, vsftpd에 기본적으로 접속거부 리스트에 root 계정이 포함되어 있다고 한다.</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/vsftpd/ftpusers</span></span>
<span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/vsftpd/user_list</span></span>
<span class="line"></span></code></pre></div><p>수정하기 (두곳에 루트만 빼면 된다)</p><p>[root@localhost vsftpd]</p><p>vi /etc/vsftpd/ftpusers</p><p>Users that are not allowed to login via ftp root bin daemon adm lp sync shutdown halt mail news uucp operator games nobody</p><p>여기서 루트만 주석처리한다.</p><p>서비스 재 시작하기</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vsftpd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span>
<span class="line"></span></code></pre></div><p>에러 해결 하기 500 OOPS: vsftpd: refusing to run with writable root inside chroot()</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/vsftpd/vsftpd.conf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">allow_writeable_chroot=yes</span></span>
<span class="line"></span></code></pre></div><p>마지막줄에서 추가한다.</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">pasv_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">Yes</span><span style="color:#A6ACCD;"> pasv_max_port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">40000</span><span style="color:#A6ACCD;"> pasv_min_port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">40000</span></span>
<span class="line"></span></code></pre></div><p>방화벽 열어주기</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--permanent</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-port=40000/tcp</span></span>
<span class="line"><span style="color:#FFCB6B;">firewall-cmd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--reload</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vsftpd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span>
<span class="line"></span></code></pre></div><p>최종 /etc/vsftpd/vsftpd.conf 파일 내용</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">anonymous_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">NO</span></span>
<span class="line"><span style="color:#A6ACCD;">local_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">write_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">local_umask</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">022</span></span>
<span class="line"><span style="color:#A6ACCD;">dirmessage_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">xferlog_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">connect_from_port_20</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">xferlog_file</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/var/log/xferlog</span></span>
<span class="line"><span style="color:#A6ACCD;">xferlog_std_format</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">chroot_local_user</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">listen</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">pam_service_name</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">vsftpd</span></span>
<span class="line"><span style="color:#A6ACCD;">userlist_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp_wrappers</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">allow_writeable_chroot</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">YES</span></span>
<span class="line"><span style="color:#A6ACCD;">pasv_enable</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">Yes</span></span>
<span class="line"><span style="color:#A6ACCD;">pasv_max_port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">40000</span></span>
<span class="line"><span style="color:#A6ACCD;">pasv_min_port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">40000</span></span>
<span class="line"></span></code></pre></div><p>여기서 아래 에러가 나온다면... 500 OOPS: run two copies of vsftpd for IPv4 and IPv6</p><p>아래처럼 yes 에서 no로 설정한다.</p><p>listen_ipv6=NO</p><p>마지막으로 중요한걸 빠졌다.</p><p>외부에 방화벽을 열어줘야한다.</p><p>아마존 서버 같은경우는 인스턴스에서 인바운드를 열면 된다.</p><p>500 OOPS: unrecognised variable in config file: userlist_eniable</p><p>이렇게 에러가 나올경우 해당 변수가 없다고 나온다.</p><p>userlist_eniable 찾아서 주석처리나 문법을 제거 하면된다.</p>`,41);function y(a,D,A,d,F,E){return t(),p("div",null,[s("h1",r,[l(o(a.$frontmatter.title)+" ",1),C]),i])}const b=n(c,[["render",y]]);export{v as __pageData,b as default};
